{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heritage UA Map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <link rel="stylesheet" href="{% static 'map_app/css/main_style.css' %}">
    <link rel="stylesheet" href="{% static 'map_app/css/quiz_style.css' %}">
    <link rel="stylesheet" href="{% static 'map_app/css/results_style.css' %}">
    <link rel="stylesheet" href="{% static 'map_app/css/auth_style.css' %}">
    <link rel="stylesheet" href="{% static 'map_app/css/suggest_photo.css' %}">


    <script>
        const UKRAINE_REGIONS_JSON_URL = "{% static 'map_app/js/ukraine_regions.json' %}";
    </script>
</head>
<body>

<div id="sidebar">
    <a href="/" class="site-title-link">
        <h1 class="sidebar-title">HERITAGE UA</h1>
    </a>

    <div class="sidebar-actions">
        <button
            id="auth-btn"
            class="sidebar-btn"
            type="button"
            data-auth="{% if request.user.is_authenticated %}1{% else %}0{% endif %}"
        >
            üë§ {% if request.user.is_authenticated %}–ü—Ä–æ—Ñ—ñ–ª—å{% else %}–£–≤—ñ–π—Ç–∏ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è{% endif %}
        </button>

        <button id="games-btn" class="sidebar-btn" type="button">
            üéÆ –Ü–≥—Ä–∏ —Ç–∞ –¢–µ—Å—Ç–∏
        </button>

{% if request.user.is_authenticated %}
<button
    id="results-btn"
    class="sidebar-btn"
    type="button"
>
    üìä –ú–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
</button>
<button
    id="suggest-btn"
    class="sidebar-btn"
    type="button"
>
    ‚ûï –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏
</button>
{% endif %}

    </div>
</div>

<div id="map"></div>

<div id="details-panel" class="details-panel" style="display:none;"></div>

<div id="quiz-screen" class="quiz-screen" style="display:none;">
    <div class="quiz-content">
        <div class="quiz-header"></div>

        <div id="region-selection-view">
            <h2>–û–±–µ—Ä—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è:</h2>
            <div id="region-list" class="region-grid"></div>
            <div style="text-align:center; margin-top:30px;">
                <button class="quiz-control-btn" onclick="window.closeQuizScreen()">‚ùå –ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>

        <div id="type-selection-view" style="display:none;">
            <h2 id="quiz-type-title">–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É:</h2>
            <div id="game-type-list" class="game-type-grid"></div>
            <div style="text-align:center; margin-top:30px;">
                <button class="quiz-control-btn" onclick="window.openRegionSelectionView()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
</div>

<div id="results-screen" class="quiz-screen" style="display:none;">
    <div class="quiz-content">
        <div class="quiz-header" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <h2 id="results-title" style="margin:0; color:white;">–í–∏–±–µ—Ä—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</h2>
            <button id="close-results-btn" class="quiz-control-btn" type="button">‚ùå –ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>

        <div id="results-body" class="quiz-body"></div>
    </div>
</div>

<div id="auth-screen" class="quiz-screen" style="display:none;">
  <div class="quiz-content">
    <div class="quiz-header"></div>

    <div class="auth-wrap">
      <div id="auth-errors" class="auth-errors" style="display:none;"></div>
      {% if request.user.is_authenticated %}
<h2 class="auth-title" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
  <span>–ü—Ä–æ—Ñ—ñ–ª—å</span>
  <button id="profile-edit-btn" type="button" class="auth-icon-btn" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è</button>
</h2>

<div id="profile-errors" class="auth-errors" style="display:none;"></div>

<form id="profile-form" class="auth-form">
  {% csrf_token %}

  <input
    id="profile-username"
    name="username"
    type="text"
    value="{{ request.user.username }}"
    disabled
    required
  >

  <input
    id="profile-email"
    name="email"
    type="email"
    value="{{ request.user.email|default:'' }}"
    placeholder="Email (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)"
    disabled
  >

  {% if request.user.has_usable_password %}
    <input id="profile-password-view" type="text" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" disabled>
  {% else %}
    <input id="profile-password-view" type="text" value="–ø–∞—Ä–æ–ª—è –Ω–µ —ñ—Å–Ω—É—î" disabled>
  {% endif %}
</form>

<div
  id="profile-meta"
  data-has-pass="{% if request.user.has_usable_password %}1{% else %}0{% endif %}"
  style="display:none;"
></div>

<div id="password-section" style="display:none; margin-top:14px;">
  <div style="color:white; font-weight:bold; text-align:center; margin-bottom:8px;">–ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—è</div>
  <div id="password-errors" class="auth-errors" style="display:none;"></div>

  <form id="password-form" class="auth-form">
    {% csrf_token %}
    <input name="old_password" type="password" autocomplete="current-password" placeholder="–°—Ç–∞—Ä–∏–π –ø–∞—Ä–æ–ª—å" required>
    <input name="new_password1" type="password" autocomplete="new-password" placeholder="–ù–æ–≤–∏–π –ø–∞—Ä–æ–ª—å" required>
    <input name="new_password2" type="password" autocomplete="new-password" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å" required>
    <button class="auth-main-btn" type="submit">–ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å</button>
  </form>
</div>

<div id="password-set-section" style="display:none; margin-top:14px;">
  <div style="color:white; font-weight:bold; text-align:center; margin-bottom:8px;">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–∞—Ä–æ–ª—å</div>
  <div id="password-set-errors" class="auth-errors" style="display:none;"></div>

  <form id="password-set-form" class="auth-form">
    {% csrf_token %}
    <input name="new_password1" type="password" autocomplete="new-password" placeholder="–ù–æ–≤–∏–π –ø–∞—Ä–æ–ª—å" required>
    <input name="new_password2" type="password" autocomplete="new-password" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å" required>
    <button class="auth-main-btn" type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø–∞—Ä–æ–ª—å</button>
  </form>
</div>

<div id="profile-actions" style="display:none; gap:10px; margin-top:12px;">
<button id="profile-save-btn" class="auth-main-btn btn-outline-green" type="button">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
<button id="profile-cancel-btn" class="auth-main-btn btn-outline-red" type="button">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
</div>

<form id="logout-form" method="post" action="{% url 'account_logout' %}" style="margin-top:14px;">
  {% csrf_token %}
  <button class="auth-main-btn danger" type="submit" style="width:100%;">–í–∏–π—Ç–∏ –∑ –ø—Ä–æ—Ñ—ñ–ª—é</button>
</form>

      {% else %}
        <h2 class="auth-title">–ê–∫–∞—É–Ω—Ç</h2>

        <a class="auth-google-btn" href="{% url 'google_login' %}">
  <span class="auth-google-icon">G</span>
  –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
</a>

        <div class="auth-tabs">
          <button class="auth-tab-btn active" type="button" data-tab="login">–í—Ö—ñ–¥</button>
          <button class="auth-tab-btn" type="button" data-tab="register">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</button>
        </div>

        <div id="auth-tab-login">
<form id="auth-login-form" method="post" action="{% url 'ajax_login' %}" class="auth-form">
            {% csrf_token %}
            <input name="login" type="text" autocomplete="username" placeholder="–õ–æ–≥—ñ–Ω –∞–±–æ Email" required>
            <input name="password" type="password" autocomplete="current-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <input type="hidden" name="next" value="/">
            <button class="auth-main-btn" type="submit">–£–≤—ñ–π—Ç–∏</button>
          </form>
        </div>

        <div id="auth-tab-register" style="display:none;">
<form id="auth-signup-form" method="post" action="{% url 'ajax_signup' %}" class="auth-form">
            {% csrf_token %}
            <input name="username" type="text" autocomplete="username" placeholder="–õ–æ–≥—ñ–Ω" required>
            <input name="email" type="email" autocomplete="email" placeholder="Email (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)">
            <input name="password1" type="password" autocomplete="new-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <input name="password2" type="password" autocomplete="new-password" placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>
            <input type="hidden" name="next" value="/">
            <button class="auth-main-btn" type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
          </form>
        </div>
      {% endif %}

      <div style="text-align:center; margin-top:18px;">
        <button id="auth-close-btn" class="quiz-control-btn" type="button">‚ùå –ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'map_app/js/main.js' %}"></script>
<script src="{% static 'map_app/js/results_submit.js' %}"></script>
<script src="{% static 'map_app/js/chronology_cards_game.js' %}"></script>
<script src="{% static 'map_app/js/location_game.js' %}"></script>
<script src="{% static 'map_app/js/quiz.js' %}"></script>
<script src="{% static 'map_app/js/results.js' %}"></script>
<script src="{% static 'map_app/js/ui_nav.js' %}"></script>
<script src="{% static 'map_app/js/suggest_photo.js' %}"></script>
<script src="{% static 'map_app/js/auth.js' %}"></script>

</body>
</html>
